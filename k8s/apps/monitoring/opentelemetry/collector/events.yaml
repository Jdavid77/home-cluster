apiVersion: opentelemetry.io/v1beta1
kind: OpenTelemetryCollector
metadata:
  name: otel-events
spec:
  managementState: managed
  upgradeStrategy: automatic
  mode: deployment
  serviceAccount: collector
  ports:
    - name: health
      port: 13113
  env:
    - name: KUBE_NODE_NAME
      valueFrom:
        fieldRef:
          fieldPath: spec.nodeName
  config:
    receivers:
      k8s_events:
        auth_type: serviceAccount
        namespaces: []
    processors:
      batch: {}
      resource/k8s_events:
        attributes:
          - action: insert
            key: job
            value: 'events'
          - action: insert
            key: loki.resource.labels
            value: job
    exporters:
      debug:
        verbosity: detailed
      otlphttp/loki:
        endpoint: http://loki-gateway.monitoring/otlp
    service:
      pipelines:
        logs:
          receivers: [k8s_events]
          processors: [batch, resource/k8s_events]
          exporters: [otlphttp/loki]
